<p></p>
<p></p>
<p></p>
<h2>Predictions</h2>
<div id="predictiondata">
{% if week > 0 %}

  <div class="record" data-bind="if: data.predictions.record">
    <h4>Prediction record: <span data-bind="text: data.predictions.record.correct"></span> - <span
    data-bind="text: data.predictions.record.wrong"></span></h4>
  </div>
  <p></p>
  <p></p>
{% endif %}

  <div class="predictions" data-bind="if: data.predictions.nextweek && data.predictions.nextweek.length">
    <h3>Predicting upcoming games</h3>
    Bars indicate the league ranking of each team in the given categroy.
    <p></p>


    <h4>Categories</h4>
    HR: Homefield Rating</br>
    O: Offensive Rating</br>
    D: Defensive Rating</br>
    PTS: Point Differentials</br>
    TO: Turnover Differentials</br>
    Y: Yard Differentials</br>

    <p></p>
    The last column shows the predicted winner with the probability of the win.
    <p></p>
    <p></p>

    <div class="predictions" data-bind="if: data.predictions.nextweek && data.predictions.nextweek.length">

      <h3>Predicting upcoming games</h3>
        <table class="table">
          <tbody>
            <tr data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()"></td>
              <td><img data-bind="attr: {src: '{{basepath}}img/' + at + '.svg'}"></img></td>
            </tr>
            <tr data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()"></td>
              <td>@</td>
            </tr>
            <tr class="separation" data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()"></td>
                <td><img data-bind="attr: {src: '{{basepath}}img/' + ht + '.svg'}"></img></td>
            </tr>
            <tr class="results" data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()">Winner</td>
              <td>
                <img class="winner" data-bind="attr: {src: '{{basepath}}img/' + ot + '.svg'}"></img>
                <div data-bind="text: o.toFixed(0) + '%'"></div>
              </td>
            </tr>
            <!--
            <tr class="results" data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()">Rate</td>
              <td>
                <img data-bind="attr: {src: '{{basepath}}img/' + wt + '.svg'}"></img>
                <div data-bind="text: w.toFixed(1)"></div>
              </td>
            </tr>
            <tr data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()">Points</td>
              <td>
                <img data-bind="attr: {src: '{{basepath}}img/' + pt + '.svg'}"></img>
                <div data-bind="text: p.toFixed(0)"></div>
              </td>
            </tr>
            <tr data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()">Yards</td>
              <td>
                <img data-bind="attr: {src: '{{basepath}}img/' + yt + '.svg'}"></img>
                <div data-bind="text: y.toFixed(0)"></div>
              </td>
            </tr>
            <tr data-bind="foreach: data.predictions.nextweek">
              <td data-bind="if: !$index()">Turnovers</td>
              <td>
                <img data-bind="attr: {src: '{{basepath}}img/' + tt + '.svg'}"></img>
                <div data-bind="text: t.toFixed(1)"></div>
              </td>
            </tr>
      -->
          </tbody>
        </table>
<!--  <div class="explanations">Positive numbers indicates advantage for home
      team.</div>-->
      <br>
      <p></p>
      <p></p>
        <table class="table">
          <tbody data-bind="foreach: data.predictions.nextweek">
            <tr class="row-awayteam" style="border-top-style: solid; border-left-style:
            solid; border-right-style: solid">
              <td class="teamflag"><img data-bind="attr: {src: '{{basepath}}img/' + at + '.svg'}"></img></td>
              <td><div data-bind="text: data.stats['away'][at]['s']['o']['rh']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['o']['rh']) + 'px'}"></div>
                  </div>
              </td>
              <td><div data-bind="text: data.stats['away'][at]['s']['o']['rr']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['o']['rr']) + 'px'}"></div>
                  </div>
              </td>
              <td><div data-bind="text: data.stats['away'][at]['s']['d']['rr']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['d']['rr']) + 'px'}"></div>
                  </div>
              </td>
              <td><div data-bind="text: data.stats['away'][at]['s']['u']['rp']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['u']['rp']) + 'px'}"></div>
                  </div>
              </td>
              <td><div data-bind="text: data.stats['away'][at]['s']['u']['rt']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['u']['rt']) + 'px'}"></div>
                  </div>
              </td>
              <td><div data-bind="text: data.stats['away'][at]['s']['u']['ry']"></div>
                  <div  data-bind="attr: {class: at}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['away'][at]['s']['u']['ry']) + 'px'}"></div>
                  </div>
              </td>
              <td class="winner" data-bind="css: { last: $index() == data.predictions.nextweek.length - 1 }" rowspan="3">
                <img data-bind="attr: {src: '{{basepath}}img/' + ot + '.svg'}"></img>
                <div data-bind="text: o.toFixed(0) + '%'"></div>
              </td>
            </tr>
            <tr class="row-middle">
              <td>@</td>
              <td>HR</td>
              <td>O</td>
              <td>D</td>
              <td>PTS</td>
              <td>TO</td>
              <td>Y</td>
            </tr>
            <tr class="row-hometeam">
              <td class="teamflag"><img data-bind="attr: {src: '{{basepath}}img/' + ht + '.svg'}"></img></td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['o']['rh']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['o']['rh']"></div>
              </td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['o']['rr']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['o']['rr']"></div>
              </td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['d']['rr']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['d']['rr']"></div>
              </td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['u']['rp']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['u']['rp']"></div>
              </td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['u']['rt']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['u']['rt']"></div>
              </td>
              <td>
                  <div  data-bind="attr: {class: ht}">
                    <div class="predictionbar" data-bind="style: { height:
                    2*(32 + 1 - data.stats['home'][ht]['s']['u']['ry']) + 'px'}"></div>
                  </div>
                  <div data-bind="text: data.stats['home'][ht]['s']['u']['ry']"></div>
              </td>
            </tr>
          </tbody>
        </table>

    </div>
  </div>

</div>
{% if week < 21 %}

<h1>Strength of remaining schedule</h1>

<svg id="sosRemain">
</svg>
<p>
</p>

{% endif %}

{% if week < 17 %}

<p>
</p>
<p>
</p>

<h1>Remaingin Schedule Details</h1>
<p>
</p>

<div id='remainingSchedule'>

  <div data-bind="foreach: { data: remainingSchedule.divisions, as: 'division' }">
<p>
</p>
<p>
</p>
    <h3 data-bind="text: division.name"></h3>
    <table class="schedule">
      <tbody data-bind="foreach: { data: division.teams, as: 'team' }">
        <tr data-bind="foreach: remainingSchedule.tschedule[team].games">
            <td data-bind="if: $index() === 0" class="winner" rowspan="2">
              <img data-bind="attr: {src: '{{basepath}}img/' + team + '.svg'}"></img>
              <div data-bind="text: remainingSchedule.tschedule[team].avg"></div>
            </td>
            <td class="schedulebar">
              <div data-bind="text: (home ? '' : '@ ') + opp"></div>
              <div data-bind="attr: {class: opp}">
                <div data-bind="style: { height:
                    or + 'px'}"></div>
              </div>
            </td>
        </tr>
        <tr>
        </tr>
    </tbody>
  </table>
  </div>
</div>


{% endif %}


<script type="text/javascript">
  var season = {{season}};
  var week = {{week}};
  if (week == 0) {
    season -= 1;
    week = 21;
  }
  var keystats = '_' + season + (week < 10 ? '0' : '') + week;
  var data = hf.stats.data[keystats];
  ko.applyBindings(data, document.getElementById('predictiondata'));
  var sosRemainset = new hf.stats.Set(season, week, 'ssoh');
  if ({{week}} < 21) {

    var sosRemainGraph = new hf.graphs.Bar('#sosRemain');
    sosRemainGraph.create(sosRemainset, '{{basepath}}');
  }


  var divisions = [
      {key: 'AFCE', name: "AFC East", teams: ['BUF', 'MIA', 'NE', 'NYJ']},
      {key: 'AFCN', name: "AFC North", teams: ['BAL', 'CIN', 'CLE', 'PIT']},
      {key: 'AFCS', name: "AFC South", teams: ['HOU', 'IND', 'JAC', 'TEN']},
      {key: 'AFCW', name: "AFC West", teams: ['DEN', 'KC', 'LAC', 'OAK']},
      {key: 'NFCE', name: "NFC East", teams: ['DAL', 'NYG', 'PHI', 'WAS']},
      {key: 'NFCN', name: "NFC North", teams: ['CHI', 'DET', 'GB', 'MIN']},
      {key: 'NFCS', name: "NFC South", teams: ['ATL', 'CAR', 'NO', 'TB']},
      {key: 'NFCW', name: "NFC West", teams: ['ARI', 'LAR', 'SEA', 'SF']}
  ];
  
  var wg = [];
  for (var ww = week + 1; ww <= 17; ww++) {
    var keynext = '_' + season + (ww < 10 ? '0' : '') + ww;
    wg.push(hf.stats.data[keynext].games);
  }

  var tschedule = {};

  for (var dd = 0; dd < divisions.length; dd++) {
    var division = divisions[dd];
    for (var tt = 0; tt < division.teams.length; tt++) {
      var curteam = division.teams[tt];
      var curgames = [];
      for (ww = 0; ww < wg.length; ww++) {
        var weekgameentry = {
          opp: 'BYE',
          or: 0.0,
          home: true
        };
        for (gg = 0; gg < wg[ww].length; gg++) {
          var game = wg[ww][gg];
          if (game.ht == curteam || game.at == curteam) {
            if (game.ht == curteam) {
              weekgameentry.opp = game.at;
              weekgameentry.or = data.stats.away[game.at].s.o.h;
              weekgameentry.home = true;
            } else {
              weekgameentry.opp = game.ht;
              weekgameentry.or = data.stats.home[game.ht].s.o.h;
              weekgameentry.home = false;
            }
          }
        }
        curgames.push(weekgameentry);
      }
      tschedule[curteam] = {
        games: curgames,
        avg: sosRemainset.teamStat(curteam)
      }
    }
  }

  var remainingSchedule = {
    divisions: divisions,
    tschedule: tschedule
  };
  
  ko.applyBindings(remainingSchedule, document.getElementById('remainingSchedule'));

  console.log(remainingSchedule);

</script>

