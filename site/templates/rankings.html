{% extends "../../_site/templates/base.html" %}

{% block pagecontent %}
<div class="title">
  <h2>NFL Power Rankings - Week {{week}} {{season}}</h2>
  <span class="byline">{{description}}</span>
  {% include "../../_site/templates/prnavigation.html" %}
</div>
<p>
{{ contents }}
</p>
<svg id="chart">
</svg>
<p>
</p>
<h3>Developement over the season</h3>
<svg id="timeline">
</svg>

<div class="predictions" data-bind="if: games">

  <h3>Predicting upcoming games</h3>

  <div class="explanations">Positive numbers indicates advantage for home team.</div>
  <br>
  <table class="table">
    <tbody>
      <tr data-bind="foreach: games">
        <td data-bind="if: !$index()"></td>
        <td><img data-bind="attr: {src: '{{basepath}}img/' + at + '.svg'}"></img></td>
      </tr>
      <tr data-bind="foreach: games">
        <td data-bind="if: !$index()"></td>
        <td>@</td>
      </tr>
      <tr class="separation" data-bind="foreach: games">
        <td data-bind="if: !$index()"></td>
          <td><img data-bind="attr: {src: '{{basepath}}img/' + ht + '.svg'}"></img></td>
      </tr>
      <tr class="results" data-bind="foreach: games">
        <td data-bind="if: !$index()">Rate</td>
        <td>
          <div data-bind="text: ($parent.homestat(ht, 'o', 'w') - $parent.awaystat(at, 'o', 'w')).toFixed(1)"></div>
          <img data-bind="attr: {src: '{{basepath}}img/' + (($parent.homestat(ht, 'o', 'w') - $parent.awaystat(at, 'o', 'w')) > 0 ? ht : at) + '.svg'}"></img>
        </td>
      </tr>
      <tr data-bind="foreach: games">
        <td data-bind="if: !$index()">Points</td>
        <td>
          <div data-bind="text: (($parent.homestat(ht, 'o', 'p') - $parent.homestat(ht, 'd', 'p')) -
                                 ($parent.awaystat(at, 'o', 'p') - $parent.awaystat(at, 'd', 'p'))).toFixed(0)"></div>
          <img data-bind="attr: {src: '{{basepath}}img/' + ((($parent.homestat(ht, 'o', 'p') - $parent.homestat(ht, 'd', 'p')) - ($parent.awaystat(at, 'o', 'p') - $parent.awaystat(at, 'd', 'p'))) > 0 ? ht : at) + '.svg'}"></img>
        </td>
      </tr>
      <tr data-bind="foreach: games">
        <td data-bind="if: !$index()">Yards</td>
        <td>
          <div data-bind="text: (($parent.homestat(ht, 'o', 'y') -
          $parent.homestat(ht, 'd', 'y')) -
                                 ($parent.awaystat(at, 'o', 'y') -
                                 $parent.awaystat(at, 'd', 'y'))).toFixed(0)"></div>
          <img data-bind="attr: {src: '{{basepath}}img/' + ((($parent.homestat(ht,
          'o', 'y') - $parent.homestat(ht, 'd', 'y')) - ($parent.awaystat(at, 'o',
          'y') - $parent.awaystat(at, 'd', 'y'))) > 0 ? ht : at) + '.svg'}"></img>
        </td>
      </tr>
      <tr data-bind="foreach: games">
        <td data-bind="if: !$index()">Turnovers</td>
        <td>
          <div data-bind="text: (($parent.homestat(ht, 'o', 't') -
          $parent.homestat(ht, 'd', 't')) -
                                 ($parent.awaystat(at, 'o', 't') -
                                 $parent.awaystat(at, 'd', 't'))).toFixed(1)"></div>
          <img data-bind="attr: {src: '{{basepath}}img/' + ((($parent.homestat(ht,
          'o', 't') - $parent.homestat(ht, 'd', 't')) - ($parent.awaystat(at, 'o',
          't') - $parent.awaystat(at, 'd', 't'))) > 0 ? ht : at) + '.svg'}"></img>
        </td>
      </tr>



    </tbody>
  </table>
</div>



<div>
{% include "../../_site/templates/prnavigation.html" %}
</div>

<script type="text/javascript">
  var newGraph = new hf.graphs.Bar('#chart');
  var set = new hf.stats.Set({{season}}, {{week}}, 'osow');
  newGraph.create(set, '{{basepath}}');

  var timeGraph = new hf.graphs.Timeline('#timeline');
  var tset = new hf.stats.Timeset({season: {{season}} - 1, week: 21},
                                 {season: {{season}}, week: {{week}}}, 'osow');
  timeGraph.create(tset, '{{basepath}}');
</script>

<script type="text/javascript">
  var key = '_' + {{season}} + (({{week}} + 1) < 10 ? '0' : '') + ({{week}} + 1);
  var keystats = '_' + {{season}} + ({{week}} < 10 ? '0' : '') + {{week}};
  var data = hf.stats.data[key];
  var home, away, games;
  if (data && data.games && data.games.length) {
    games = data.games;
    home = hf.stats.data[keystats].stats.home;
    away = hf.stats.data[keystats].stats.away;

    games.homestat = function(t, offdef, s) {
      return home[t].s[offdef][s];
    };
    games.awaystat = function(t, offdef, s) {
      return away[t].s[offdef][s];
    };
  }
  ko.applyBindings(games);
</script>
{% include "../../_site/templates/disqus.html" %}


{% endblock %}
