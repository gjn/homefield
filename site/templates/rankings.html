{% extends "../../_site/templates/base.html" %}

{% block pagecontent %}
<div class="title">
  <h2>NFL Power Rankings - Week {{week}} {{season}}</h2>
  <span class="byline">{{description}}</span>
  {% include "../../_site/templates/prnavigation.html" %}
</div>

<p>
{{ contents }}
</p>


<svg id="chart">
</svg>
<p>
</p>

<h3>Developement over the season</h3>
<svg id="timeline">
</svg>

<h3>Offensive and Defensive Ratings</h3>
<svg id="bubble">
</svg>

<h3>Strength of schedule faced during season</h3>
<svg id="sosseason">
</svg>

<div>
{% include "../../_site/templates/predictions.html" %}
</div>

<div>
{% include "../../_site/templates/prnavigation.html" %}
</div>

<script type="text/javascript">
  var dataset = 'osoh';
  var aggregator, filter;

  params = URI.parseQuery(location.search);
  if (params.dataset && params.dataset.length == 4) {
    dataset = params.dataset;
  }
  if (params.aggregator) {
    aggregator = params.aggregator;
  }
  if (params.filter) {
    filter = params.filter;
  }
  window.console.log(dataset, filter, aggregator);
  var newGraph = new hf.graphs.Bar('#chart');
  var set = new hf.stats.Set({{season}}, {{week}}, dataset);
  if (filter) {
    set = set.filter(filter);
  }
  if (aggregator) {
    set = set.aggregate(aggregator);
  }
  
  newGraph.create(set, '{{basepath}}');

  var timeGraph = new hf.graphs.Timeline('#timeline');
  var tset = new hf.stats.Timeset({season: {{season}} - 1, week: 21},
                                 {season: {{season}}, week: {{week}}}, dataset);
  if (filter) {
    tset = tset.filter(filter);
  }
  if (aggregator) {
    tset = tset.aggregate(aggregator);
  }
  timeGraph.create(tset, '{{basepath}}');


  var setX = new hf.stats.Set({{season}}, {{week}}, 'osor').filter(filter); 
  var setY = new hf.stats.Set({{season}}, {{week}}, 'osdr').filter(filter); 
  var setR = new hf.stats.Set({{season}}, {{week}}, 'osow').filter(filter); 

  var bubbleGraph = new hf.graphs.Bubble('#bubble');
  bubbleGraph.create(setX, setY, setR, '{{basepath}}');

  var sosSeasonGraph = new hf.graphs.Timeline('#sosseason');
  var sosSeasontset = new hf.stats.Timeset({season: {{season}} - 1, week: 21},
                                 {season: {{season}}, week: {{week}}}, 'oooh');
  if (filter) {
    sosSeasontset = sosSeasontset.filter(filter);
  }
  if (aggregator) {
    sosSeasontset = sosSeasontset.aggregate(aggregator);
  }
  sosSeasonGraph.create(sosSeasontset, '{{basepath}}');

</script>

{% include "../../_site/templates/disqus.html" %}


{% endblock %}
